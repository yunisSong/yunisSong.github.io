---
layout:     post
title:      iOS应用架构谈学习笔记
subtitle:   在不断填坑中前进。。
date:       2017-08-23
author:     三十一
header-img: img/post-bg-nextgen-web-pwa.jpg
header-mask: 0.3
catalog:    true
tags:
   - 内功
---

# iOS应用架构谈学习笔记

本文是学习 [反革命工程师](https://casatwy.com/) 关于架构的的一系列博文的笔记。

原博文链接：
[iOS应用架构谈 开篇](https://casatwy.com/iosying-yong-jia-gou-tan-kai-pian.html)
[iOS应用架构谈 view层的组织和调用方案](https://casatwy.com/iosying-yong-jia-gou-tan-viewceng-de-zu-zhi-he-diao-yong-fang-an.html)
[iOS应用架构谈 网络层设计方案](https://casatwy.com/iosying-yong-jia-gou-tan-wang-luo-ceng-she-ji-fang-an.html)
[iOS应用架构谈 本地持久化方案及动态部署](https://casatwy.com/iosying-yong-jia-gou-tan-ben-di-chi-jiu-hua-fang-an-ji-dong-tai-bu-shu.html)
[iOS应用架构谈 组件化方案](https://casatwy.com/iOS-Modulization.html)


## view层的组织和调用方案


### 代码布局
代码布局的大概样式。

```
#pragma mark - Life Cycle

- (void)viewDidLoad {
    [super viewDidLoad];
    //加载页面
}
- (void)viewWillAppear:(BOOL)animated
{
    [super viewWillAppear:animated];
    //布局
}
- (void)viewDidAppear:(BOOL)animated
{
    [super viewDidAppear:animated];
    //监听事件
}
- (void)dealloc
{
    
}
#pragma mark - Intial Methods
//初始化数据
- (void)assignDate
{
    
}
- (void)settingAppearance
{
    
}
- (void)loadSubViews
{
    
}
#pragma mark - Target Methods
//点击事件或通知事件

#pragma mark - Network Methods
//网络请求

#pragma mark - Public Method
//外部方法

#pragma mark - Private Method
//本类方法

#pragma mark - Delegate
//代理方法


#pragma mark - Lazy Loads
//懒加载 Getter方法

#pragma mark - set
//Setter方法
```

 **每一个delegate都把对应的protocol名字带上，delegate方法不要到处乱写，写到一块区域里面去**





### 在iOS开发领域中，怎样才算是MVC划分的正确姿势？

M应该做的事：

* 给ViewController提供数据
* 给ViewController存储数据提供接口
* 提供经过抽象的业务基本组件，供Controller调度

C应该做的事：

* 管理View Container的生命周期
* 负责生成所有的View实例，并放入View Container
* 监听来自View与业务有关的事件，通过与Model的合作，来完成对应事件的业务。

V应该做的事：

* 响应与业务无关的事件，并因此引发动画效果，点击反馈（如果合适的话，尽量还是放在View去做）等。
* 界面元素表达

#### 拆分的心法

* 第一心法：保留最重要的任务，拆分其它不重要的任务

    * 在iOS开发领域内，UIViewController承载了非常多的事情，比如View的初始化，业务逻辑，事件响应，数据加工等等，当然还有更多我现在也列举不出来，但是我们知道有一件事情Controller肯定逃不掉要做：协调V和M。也就是说，不管怎么拆，协调工作是拆不掉的。那么剩下的事情我们就可以拆了，比如    UITableView的DataSource。

* 第二心法：拆分后的模块要尽可能提高可复用性，尽量做到DRY

    * 根据第一心法拆开来的东西，很有可能还是强业务相关的，这种情况有的时候无法避免。但我们拆也要拆得好看，拆出来的部分最好能够归成某一类对象，然后最好能够抽象出一个通用逻辑出来，使他能够复用。即使不能抽出通用逻辑，那也尽量抽象出一个protocol，来实现IOP。这里有篇关于[IOP的文章](https://casatwy.com/tiao-chu-mian-xiang-dui-xiang-si-xiang-er-duo-tai.html)，大家看了就明白优越性了。

* 第三心法：要尽可能提高拆分模块后的抽象度

    * 尽量高层级的抽象。


#### 设计心法

* 第一心法：尽可能减少继承层级，涉及苹果原生对象的尽量不要继承
    * 继承是罪恶，尽量不要继承。
* 第二心法：做好代码规范，规定好代码在文件中的布局，尤其是ViewController
    * 这主要是为了提高可维护性。在一个文件非常大的对象中，尤其要限制好不同类型的代码在文件中的布局。
* 第三心法：能不放在Controller做的事情就尽量不要放在Controller里面去做

#### 小总结

其实针对View层的架构设计，还是要做好三点：`代码规范`，`架构模式`，`工具集`。

代码规范对于View层来说意义重大，毕竟View层非常重业务，如果代码布局混乱，后来者很难接手，也很难维护。

架构模式具体如何选择，完全取决于业务复杂度。如果业务相当相当复杂，那就可以使用VIPER，如果相对简单，那就直接MVC稍微改改就好了。每一种已经成为定式的架构模式不见得都适合各自公司对应的业务，所以需要各位架构师根据情况去做一些拆分或者改变。拆分一般都不会出现问题，改变的时候，只要别把MVC三个角色搞混就好了，M该做啥做啥，C该做啥做啥，V该做啥做啥，不要乱来。关于大部分的架构模式应该是什么样子，这篇文章里都已经说过了，不过我认为最重要的还是后面的心法，模式只是招术，熟悉了心法才能大巧不工。

View层的工具集主要还是集中在如何对View进行布局，以及一些特定的View，比如带搜索提示的搜索框这种。这篇文章只提到了View布局的工具集，其它的工具集相对而言是更加取决于各自公司的业务的，各自实现或者使用CocoaPods里现成的都不是很难。

对于小规模或者中等规模iOS开发团队来说，做好以上三点就足够了。在大规模团队中，有一个额外问题要考虑，就是跨业务页面调用方案的设计。

