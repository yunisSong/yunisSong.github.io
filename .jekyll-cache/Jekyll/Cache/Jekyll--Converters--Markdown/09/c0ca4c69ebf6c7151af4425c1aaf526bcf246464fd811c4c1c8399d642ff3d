I"É)<h1 id="è‡ªåŠ¨åŒ–çš„ä¸€äº›å®è·µ">è‡ªåŠ¨åŒ–çš„ä¸€äº›å®è·µ</h1>

<h3 id="xcodeç‰ˆæœ¬æ›´æ–°åæŠ¥é”™">Xcodeç‰ˆæœ¬æ›´æ–°åæŠ¥é”™</h3>
<h4 id="xcode9">Xcode9</h4>
<p>æ›´æ–°åˆ° Xcode 9 åæŠ¥é”™</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error Domain=IDEProvisioningErrorDomain Code=9 ""XXXXXX.app" requires a provisioning profile." UserInfo={NSLocalizedDescription="XXXXXXX.app" requires a provisioning profile., NSLocalizedRecoverySuggestion=Select a provisioning profile for the "Default" build configuration in the project editor.}

</code></pre></div></div>

<p>å‚è€ƒé“¾æ¥ï¼š<a href="https://stackoverflow.com/a/45888412">stackoverflow</a> ,plist æ–‡ä»¶å†…å®¹ä¿®æ”¹å¦‚ä¸‹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
  &lt;dict&gt;
      &lt;key&gt;provisioningProfiles&lt;/key&gt;
      &lt;dict&gt;
          &lt;key&gt;MY_APP_BUNDLE_ID&lt;/key&gt;
          &lt;string&gt;MY_PROFILE_NAME_AS_SHOWN_BY_XCODE or UUID_FOUND_IN_MOBILEPROVISION_FILE&lt;/string&gt;
      &lt;/dict&gt;
      &lt;key&gt;method&lt;/key&gt;
      &lt;string&gt;development&lt;/string&gt;
      &lt;key&gt;uploadBitcode&lt;/key&gt;
      &lt;false/&gt;
      &lt;key&gt;uploadSymbols&lt;/key&gt;
      &lt;true/&gt;
  &lt;/dict&gt;
&lt;/plist&gt;
</code></pre></div></div>
<h4 id="xcode833">Xcode8.3.3</h4>
<blockquote>
  <p>æ›´æ–° Xcode å‡çº§åˆ°8.3.3 ä»¥åï¼ŒåŸæœ‰æ‰“åŒ…è„šæœ¬å‡ºé”™ï¼Œéœ€è¦åœ¨æŒ‡å®šç›®å½•æ·»åŠ ä¸€ä¸ªplistæ–‡ä»¶ï¼Œç°ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
</blockquote>

<p>plist æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼Œå‚è€ƒé“¾æ¥ <a href="https://stackoverflow.com/a/43154970/7771598">stackoverflow</a>ï¼š</p>
<blockquote>
  <p>Youâ€™ll have to at least specifiy an entry for method (app-store, ad-hoc, enterprise etc. - defaults to development).</p>

</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
    &lt;dict&gt;
        &lt;key&gt;method&lt;/key&gt;
        &lt;string&gt;development&lt;/string&gt;
    &lt;/dict&gt;
&lt;/plist&gt;

</code></pre></div></div>

<hr />
<p><code class="language-plaintext highlighter-rouge">plist</code> æ–‡ä»¶éœ€è¦æ”¾åœ¨è„šæœ¬é‡Œé¢ targerIPA_parth è·¯å¾„ä¸‹ã€‚</p>

<h3 id="æ‰“åŒ…è„šæœ¬">æ‰“åŒ…è„šæœ¬</h3>
<p>ä»Šå¤©å°è¯•äº†ä¸‹ä½¿ç”¨è„šæœ¬è‡ªåŠ¨åŒ–æ‰“åŒ…å¹¶å‘å¸ƒåˆ°è’²å…¬è‹±ï¼Œç°è®°å½•å¦‚ä¸‹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># -*- coding: utf-8 -*-
</span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1">#å‘å¸ƒåˆ°è’²å…¬è‹±çš„è¯´æ˜æ–‡æ¡£
</span><span class="n">updateDescription</span> <span class="o">=</span> <span class="s">""</span>
<span class="c1"># é¡¹ç›®æ ¹ç›®å½•
</span><span class="n">project_path</span> <span class="o">=</span> <span class="s">""</span>

<span class="c1">#æ‰“åŒ…è¯ä¹¦åç§°
</span><span class="n">cerName</span> <span class="o">=</span> <span class="s">""</span>
<span class="c1">#å‘å¸ƒè¯ä¹¦
#cerName = ""
#å·¥ç¨‹åç§°
</span><span class="n">projectName</span> <span class="o">=</span> <span class="s">""</span><span class="o">+</span><span class="s">".xcodeproj"</span>
<span class="c1">#scheme
</span><span class="n">scheme</span> <span class="o">=</span> <span class="s">""</span>
<span class="c1"># æ‰“åŒ…åipaå­˜å‚¨ç›®å½•
</span><span class="n">targerIPA_parth</span> <span class="o">=</span> <span class="s">""</span>



<span class="c1">#æ—¶é—´æˆ³
</span><span class="n">timeStr</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%Y-%m-%d%H%M%S'</span><span class="p">,</span><span class="n">time</span><span class="p">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()))</span>
<span class="c1">#activePath
</span><span class="n">activePath</span> <span class="o">=</span> <span class="n">targerIPA_parth</span> <span class="o">+</span><span class="n">timeStr</span><span class="o">+</span><span class="s">".xcarchive"</span>
<span class="c1">#è’²å…¬è‹±Key
</span><span class="n">PGY_key</span><span class="o">=</span><span class="s">""</span>
<span class="c1">#è’²å…¬è‹±APIKey
</span><span class="n">PGY_APIkey</span><span class="o">=</span><span class="s">""</span>


<span class="c1"># æ¸…ç†é¡¹ç›® åˆ›å»ºbuildç›®å½•
</span><span class="k">def</span> <span class="nf">clean_project_mkdir_build</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"******clean******"</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">system</span><span class="p">(</span><span class="s">'cd %s;xcodebuild clean -project "%s" -scheme %s -configuration release'</span> <span class="o">%</span> <span class="p">(</span><span class="n">project_path</span><span class="p">,</span><span class="n">projectName</span><span class="p">,</span><span class="n">scheme</span><span class="p">))</span> <span class="c1"># clean é¡¹ç›®
</span>
<span class="k">def</span> <span class="nf">build_project</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"build xcarchive start"</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">system</span> <span class="p">(</span><span class="s">'xcodebuild -list'</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">system</span> <span class="p">(</span><span class="s">'cd %s;xcodebuild archive -project "%s" -scheme %s -configuration release -sdk iphoneos10.3  IPHONEOS_DEPLOYMENT_TARGET=9.0 -archivePath %s;'</span> <span class="o">%</span> <span class="p">(</span><span class="n">project_path</span><span class="p">,</span><span class="n">projectName</span><span class="p">,</span><span class="n">scheme</span><span class="p">,</span><span class="n">activePath</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"build xcarchive end"</span><span class="p">)</span>

<span class="c1"># æ‰“åŒ…ipa å¹¶ä¸”ä¿å­˜åœ¨æ¡Œé¢
</span><span class="k">def</span> <span class="nf">build_ipa</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"build IPA start"</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">targerIPA_parth</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">system</span> <span class="p">(</span><span class="s">'xcodebuild -exportArchive -archivePath %s -exportPath %s -exportOptionsPlist %sIPA.plist'</span><span class="o">%</span><span class="p">(</span><span class="n">activePath</span><span class="p">,</span><span class="n">targerIPA_parth</span><span class="p">,</span><span class="n">targerIPA_parth</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"build IPA end"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">updateIPAToPGY</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"å¼€å§‹ä¸Šä¼ è’²å…¬è‹±"</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">system</span> <span class="p">(</span><span class="s">'curl -F </span><span class="se">\"</span><span class="s">updateDescription=%s</span><span class="se">\"</span><span class="s"> -F </span><span class="se">\"</span><span class="s">file=@%scopm_cust.ipa</span><span class="se">\"</span><span class="s"> -F </span><span class="se">\"</span><span class="s">uKey=%s</span><span class="se">\"</span><span class="s"> -F </span><span class="se">\"</span><span class="s">_api_key=%s</span><span class="se">\"</span><span class="s"> https://qiniu-storage.pgyer.com/apiv1/app/upload'</span><span class="o">%</span><span class="p">(</span><span class="n">updateDescription</span><span class="p">,</span><span class="n">targerIPA_parth</span><span class="p">,</span><span class="n">PGY_key</span><span class="p">,</span><span class="n">PGY_APIkey</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"ä¸Šä¼ è’²å…¬è‹±å®Œæˆ"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">updateSVN</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"æ›´æ–°SVNæ•°æ®"</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">project_path</span><span class="p">)</span>    
    <span class="n">os</span><span class="p">.</span><span class="n">system</span> <span class="p">(</span><span class="s">'svn upgrade '</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">system</span> <span class="p">(</span><span class="s">'svn update '</span><span class="p">)</span>    
    <span class="k">print</span><span class="p">(</span><span class="s">"æ›´æ–°SVNå®Œæˆ"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    
    <span class="c1">#æ›´æ–°SVN
</span>    <span class="n">updateSVN</span><span class="p">()</span>
    <span class="c1"># æ¸…ç†å¹¶åˆ›å»ºbuildç›®å½•
</span>    <span class="n">clean_project_mkdir_build</span><span class="p">()</span>
    <span class="c1"># ç¼–è¯‘coocaPodsé¡¹ç›®æ–‡ä»¶å¹¶ æ‰§è¡Œç¼–è¯‘ç›®å½•
</span>    <span class="n">build_project</span><span class="p">()</span>
    <span class="c1"># æ‰“åŒ…ipa å¹¶åˆ¶å®šåˆ°æ¡Œé¢
</span>    <span class="n">build_ipa</span><span class="p">()</span>
    <span class="c1">#ä¸Šä¼ åˆ°è’²å…¬è‹±
</span>    <span class="n">updateIPAToPGY</span><span class="p">()</span>

<span class="c1"># æ‰§è¡Œ
</span><span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

:ET